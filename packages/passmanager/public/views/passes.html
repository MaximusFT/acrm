<section data-ng-controller="PasswordsController">
	<h1>Passwords Manager</h1>
	<div data-ng-if="mode === 'Administrator'">
		<tabset>
			<tab select="init()">
				<tab-heading>
					<i class="glyphicon glyphicon-eye-open"></i> All
				</tab-heading>
				
				<div class="panel panel-default">
					<div class="panel-heading">Adding new passwords</div>
					<div class="panel-body">
						<form id="pass-add-form" class="row-fluid form-inline" name="addPassForm" data-ng-submit="add()">
							<div class="row">
								<div class="col-md-8">
									<span data-ng-repeat="field in passSchema">
										<input data-ng-if="(field['type'] == 'text' || field['type'] == 'password')" type="{{field['type']}}" class="span2" data-ng-model="pass[field['schemaKey']]" placeholder="{{field['title']}}" id="pass-add-title" />
										<select class="form-control" data-ng-if="field['type'] == 'select'" data-ng-model="pass[field['schemaKey']]" ng-multiple="true" multiple ng-options="option for option in field['options']">
											<option value="">-- Choose Role --</option>
										</select>
									</span>
								</div>
								<div class="col-md-4">
									<input type="submit" class="btn span1" value="Add" />
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="panel panel-default" data-ng-show="groups.length">
					<div class="panel-heading">Control panel</div>
					<div class="panel-body" >
						<div class="row">
							<div class="col-md-8">
								<div class="btn-group dropdown">
									<button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" data-ng-disabled="isSomeSelected">Assign selected <span class="caret"></span></button>
									<ul class="dropdown-menu">
										<li data-ng-click="assignToPerson()"><a href="">To person(s)</a></li>
										<li data-ng-click="assignToDepartment()"><a href="">To department</a></li>
									</ul>
								</div>
								<div class="btn-group" style="padding: 10px;">
									<!--<input type="button" class="btn btn-danger" data-ng-hide="edit" data-ng-click="toogleEditMode()" value="Enable edit mode">
									<input type="button" class="btn btn-primary" data-ng-show="edit" data-ng-click="toogleEditMode()" value="Disable edit mode">-->								
									<input type="button" class="btn btn-danger" value="Remove selected" data-ng-disabled="isSomeSelected">
								</div>
								<input type="text" style="padding: 5px; margin-left: 12px" placeholder="Search" ng-model="search">
							</div>
						</div>
					</div>
				</div>
				<accordion close-others="true">
				<div data-ng-repeat="group in groups" data-ng-init="sectionIndex=$index">
					<accordion-group data-ng-show="group.passes.length" heading="{{group.group}} ({{group.passes.length}})">
					<table class="table table-striped table-bordered table-hover editable-table" data-ng-show="group.passes.length">
						<tr>
							<!--<th data-ng-show="edit" style="text-align: center;">
								<i class="glyphicon glyphicon-remove"></i>
							</th>-->					
							<th>
								<i class="glyphicon glyphicon-sort-by-order"></i>
							</th>
							<th>
								<i class="glyphicon glyphicon-ok" data-ng-click="selectAll(sectionIndex)"></i>
							</th>
							<th data-ng-repeat="field in passSchema" data-ng-if="field.inTable">{{field.title}}</th>
						</tr>
						<tr data-ng-repeat="pass in group.passes | filter:search:strict">
							<!--<td data-ng-show="edit">
								<button class="glyphicon glyphicon-trash" data-ng-click="remove(pass)" value="del">
									<i class="icon-trash icon-white"></i>
								</button>
							</td>-->					
							<td>
								<a href="#!/manager/passwords/{{pass['_id']}}">{{$index+1}}</a>
							</td>
							<td>
								<input type="checkbox" data-ng-model="pass.Selected" data-ng-click="checkPass(sectionIndex, $index, pass)">							
							</td>
							<td class="table-editable-cell" data-ng-repeat="field in passSchema" data-ng-if="field.inTable">
								<span data-ng-if="(field['type'] == 'text' || field['type'] == 'password')" class="editable-span" data-ng-editable="update(pass, field['schemaKey'])" data-ng-editable-model="pass[field['schemaKey']]"></span>
								<span data-ng-click="beforeSelect(field['schemaKey'], pass)" data-ng-if="(field['type'] == 'select')" class="editable-span" data-ng-editable-select="update(pass, field['schemaKey'])" data-ng-editable-select-model="pass[field['schemaKey']]" data-ng-editable-select-options="field['options']"></span>							
							</td>
						</tr>
					</table>
					</accordion-group>
				</div>
				</accordion>				
			</tab>
			<tab select="init__()">
				<tab-heading>
					<i class="glyphicon glyphicon-share"></i> Requests
				</tab-heading>
				<div>
					<table class="table table-striped table-bordered table-hover editable-table" data-ng-show="requests.length">
						<tr>
							<th colspan="6" style="text-transform: uppercase;">Requests from managers</th>
						</tr>
						<tr>
							<th>
								#
							</th>
							<th>Who</th>
							<th>What</th>
							<th>When</th>
							<th>Comment</th>
							<th style="text-align: center;"><i class="glyphicon glyphicon-flag"></i> Actions</th>
						</tr>
						<tr data-ng-repeat="request in requests | filter:search:strict">
							<td>
								<a href="#!/manager/passwords/{{request['what']._id}}">{{$index+1}}</a>								
							</td>
							<td>
								<a href="#!/manager/users/{{request['who'].username}}"><span>Name: {{request['who'].name}}<br \>Username: {{request['who'].username}}<br \>Department: {{request['who'].department}}<br \>Phone: {{request['who'].phone}}</span></a>
							</td>
							<td>
								<span>{{request['what'].resourceName}} ({{request['what'].resourceUrl}})</span>
							</td>
							<td>
								<span>{{request['when']}}</span>
							</td>
							<td>
								<span>{{request['comment']}}</span>
							</td>
							<td style="text-align: center;">
								<div class="btn-group">
									<button data-ng-hide="btn_class[$index] != null || btn_deny_class[$index] != null" ng-class="btn_class[$index] == null ? 'btn btn-danger' : btn_class[$index]" data-ng-click="provideAccess($index)" data-ng-disabled="!btn_class[$index] ? false : true">{{!btn_class[$index] ? 'Provide Access' : 'Access was shared'}}</button>
									<button data-ng-hide="btn_class[$index] != null || btn_deny_class[$index] != null" ng-class="btn_deny_class[$index] == null ? 'btn btn-warning' : btn_deny_class[$index]" data-ng-click="rejectAccess($index)" data-ng-disabled="!btn_deny_class[$index] ? false : true">{{!btn_deny_class[$index] ? 'Reject' : 'Request was removed'}}</button>
									<button data-ng-show="btn_class[$index] != null || btn_deny_class[$index] != null" class="btn btn-info" data-ng-disabled="true">Done</button>
								</div>
							</td>
						</tr>
					</table>
					<div data-ng-if="!isRequests"><br \>
						<p class='bg-warning'>There are no unprocessed requests.</p>
					</div>
				</div>
			</tab>
		</tabset>
	</div>
	<div data-ng-if="mode === 'Manager'">
		<tabset>
			<tab select="init_()">
				<tab-heading>
					<i class="glyphicon glyphicon-check"></i> Accessible for department
				</tab-heading>
				<div data-ng-repeat="group in groups">
					<h2 data-ng-show="group.passes.length">{{group.group}}</h2>
					<table class="table table-striped table-bordered table-hover editable-table" data-ng-show="group.passes.length">
						<tr>
							<th data-ng-show="edit">
								Edit
							</th>
							<th>
								#
							</th>
							<th data-ng-repeat="field in passSchema" data-ng-if="field.inTable">{{field.title}}</th>
						</tr>
						<tr data-ng-repeat="pass in group.passes | filter:search:strict">
							<td data-ng-show="edit">
								<button class="glyphicon glyphicon-trash" data-ng-click="remove(pass)" value="del">
									<i class="icon-trash icon-white"></i>
								</button>
							</td>
							<td>
								<a href="#!/manager/passwords/{{pass['_id']}}">#</a>
							</td>
							<td class="table-editable-cell" data-ng-repeat="field in passSchema" data-ng-if="field.inTable">
								<span data-ng-if="(field['type'] == 'text' || field['type'] == 'password')" class="editable-span" data-ng-editable="update(pass, field['schemaKey'])" data-ng-editable-model="pass[field['schemaKey']]"></span>
								<span data-ng-click="beforeSelect(field['schemaKey'], pass)" data-ng-if="(field['type'] == 'select')" class="editable-span" data-ng-editable-select="update(pass, field['schemaKey'])" data-ng-editable-select-model="pass[field['schemaKey']]" data-ng-editable-select-options="field['options']"></span>
							</td>
						</tr>
					</table>
				</div>
			</tab>
			<tab select="init()">
				<tab-heading>
					<i class="glyphicon glyphicon-lock"></i> All
				</tab-heading>
				<div data-ng-repeat="group in groups" data-ng-init="sectionIndex=$index">
					<table class="table table-striped table-bordered table-hover editable-table" data-ng-show="groups.length">
						<tr>
							<th colspan="4" style="text-transform: uppercase;">{{group.group}}</th>
						</tr>
						<tr>
							<th>
								#
							</th>
							<th>Resource Name</th>
							<th>Resource Url</th>
							<th>Request</th>
						</tr>
						<tr data-ng-repeat="pass in group.passes | filter:search:strict">
							<td>
								<a href="#!/manager/passwords/{{pass['_id']}}">#</a>
							</td>
							<td>
								<span>{{pass['resourceName']}}</span>
							</td>
							<td>
								<span>{{pass['resourceUrl']}}</span>
							</td>
							<td style="text-align: center;">
								<button ng-class="btn_class[sectionIndex][$index] == null ? 'btn btn-primary' : btn_class[sectionIndex][$index]" data-ng-click="sendRequest(sectionIndex,$index,pass['_id'])" data-ng-disabled="!btn_class[sectionIndex][$index] ? false : true">{{!btn_class[sectionIndex][$index] ? 'Request Access' : 'Request was sent'}}</button>
							</td>
						</tr>
					</table>
				</div>
			</tab>
		</tabset>
	</div>
</section>